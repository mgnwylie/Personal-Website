	
	<!doctype html>
<html lang="en">
  <head>
    <title>MEGAN WYLIE - Analyzing stocks and portfolios with R Ladies</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

    
    <link href="/css/milk.min.css" rel="stylesheet">
    <link href="/css/milk-responsive.min.css" rel="stylesheet">     
    <link href="/css/style.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/fonts.css" rel="stylesheet" type="text/css" media="all">
    <link rel="shortcut icon" href="/images/alexfinn.ico">
    <link rel="apple-touch-icon" href="">
    <link rel="canonical" href="/2020/01/21/analyzing-stock-value-with-r-ladies/">

    
    <link href="/rss.xml" type="application/atom+xml" rel="alternate" title="A Megan website">

  </head>
  <body>
    <div class="navbar navbar-fixed-top">
  <div id="navbar-inner">
    <div id="logo">
       <a href=""><img src="/images/profile-pic.jpg" width="100px"></img></a>
    </div>
  </div>
</div>


<div class="container">
  <div class="content">
    <div class="row-fluid">
      <div class="span12">
        <div class="posts">

	    
	  <div class="post">
	    <header class="post-header">
	        <h1><a href="/2020/01/21/analyzing-stock-value-with-r-ladies/">Analyzing stocks and portfolios with R Ladies</a></h1>
	        <div class="post-time">January 21 2020</div>
	    </header>
	    <div class="post-after">
	        <div class="tags">
	            
	                <a href="//tags/r">R</a>
	            
	                <a href="//tags/porfolio-analysis">Porfolio Analysis</a>
	            
	                <a href="//tags/stocks">Stocks</a>
	            
	                <a href="//tags/efficient-frontier">Efficient Frontier</a>
	            
	        </div>
	    </div>
	    <hr>
	    <div class="post content">
	        
<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/plotly-binding/plotly.js"></script>
<script src="/rmarkdown-libs/typedarray/typedarray.min.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>
<link href="/rmarkdown-libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="/rmarkdown-libs/plotly-main/plotly-latest.min.js"></script>


<p>This week for R Ladies we did a tutorial on stock market analysis. Led by Scott Clone, the group downloaded data on stock market prices from the internet, reformatted the data, and created a portfolio of the stocks based on risk preferences.</p>
<p>All code here was written by Scott Clone, and I just outline my own learnings from the tutorial.</p>
<div id="documents" class="section level1">
<h1>Documents</h1>
<p>As usual, all of the documents can be found on the <a href="https://github.com/rladies/meetup-presentations_montreal">RLadies GitHub page</a>. The documents for this particular tutorial are on <a href="https://github.com/Scott-Clone/portfolio-modelling/tree/993f826eee0fec086201875b14ed0ac4d53c02e8">Scott Clone’s GitHub</a>.</p>
<p>In this meetup we learned:</p>
<ul>
<li>Extracting stock price and returns data from the internet</li>
<li>Grouping data into stock portfolios</li>
<li>Estimating risk of portfolios using economic risk methods</li>
</ul>
</div>
<div id="tutorial-portfolio-modelling" class="section level1">
<h1>Tutorial: Portfolio Modelling</h1>
<div id="side-note-setting-up-r-chunks-in-r-markdown-rmd" class="section level2">
<h2>Side note: Setting up R chunks in R Markdown (RMD)</h2>
<p>An important part of R Markdown is setting up the R chunks. These R-chunk settings decide if the R code is run and displayed on my blog (where you’re probably reading this!) or if the output is the only visible feature. This is really cool because it means that I can have code that is:</p>
<ol style="list-style-type: decimal">
<li>not displayed, or</li>
<li>not run, or</li>
<li>the complete opposite (or some inbetween).</li>
</ol>
<p>There are a few settings that allow me to do this (and a lot more to explore).</p>
<p><em>include = FALSE</em> means that the code doesn’t run when I generate the blog post, therefore not displaying unneccessary errors or notes about loading a package. It also means that the output is not displayed.</p>
<p><em>echo = FALSE</em> means that the code will not be shown in the post. I set it to TRUE.</p>
<p><em>message = FALSE</em> means that errors and messages regarding the code will not be shown.</p>
</div>
<div id="getting-stock-price-and-returns-data" class="section level2">
<h2>Getting stock price and returns data</h2>
<p>The below code sets up a function to extract stock data from the internet. The dataframe getSymbolData sets the date parameters: from 2019-06-01 until 2019-12-31 and sets up column names and values: r_data, price_data, and returns_data.</p>
<pre class="r"><code># set parameters for the stock dates, as start and end.
getSymbolData &lt;- function(symbolList, start = &quot;2019-06-01&quot;, end = &quot;2019-12-31&quot;){
  getSymbols(
    symbolList, 
    auto.assign = TRUE,
    from = start, 
    to = end,
  )
    p_data &lt;- xts(
    get(symbolList[1])[, 6]
  )
  for (i in 2:length(symbolList)){
    p_data &lt;- merge.xts(p_data, get(symbolList[i])[, 6])
  }
  colnames(p_data) &lt;- symbolList
  # calculate returns for price and returns data, rename columns
  r_data &lt;- na.omit(CalculateReturns(p_data))
  colnames(r_data) &lt;- symbolList
  list(returns_data = r_data, price_data = p_data)
}</code></pre>
<p>We chose to use data from the Bank of Nova Scotia (BNS), Air Canada, Shopify, and GoEasy. These were arbitrary choices, and you can find the companies stock code by just googling <em>stock [company name]</em></p>
<p>This outputs a data frame with stock data for returns and prices from our chosen companies.</p>
<p>We group them into the <em>my_stocks</em> data frame to be used later on in this tutorial.</p>
<pre class="r"><code># Stocks for BNS, Air Canada, Shopify, goeasy
my_stocks &lt;- getSymbolData(c(&quot;BNS.TO&quot;, &quot;AC&quot;, &quot;SHOP&quot;, &quot;GSY&quot;))</code></pre>
<p>Here we separated the return data and the price data into two separate data frames and renamed the column headers.</p>
<pre class="r"><code>#This makes it a data frame of return data.  
return_data &lt;- as.data.frame(my_stocks$returns_data)

#This changes the name to BNS_TO from BNS.TO
names(return_data) &lt;- c(&quot;BNS_TO&quot;, &quot;AC&quot;, &quot;SHOP&quot;, &quot;GSY&quot;)

#Do the same for price data
#return_data$Date &lt;- index(my_stocks$returns_data)
price_data &lt;- as.data.frame(my_stocks$price_data)
names(price_data) &lt;- c(&quot;BNS_TO&quot;, &quot;AC&quot;, &quot;SHOP&quot;, &quot;GSY&quot;)</code></pre>
<p>We can then plot the data!</p>
<p>The below plot uses the package <a href="https://plot.ly/">Plotly</a>, for interactive plots, to display price data for BNS.</p>
<pre class="r"><code># Look at plot
plotly::plot_ly(
  data = price_data,
  y = ~ BNS_TO,
  type = &quot;scatter&quot;,
  mode = &quot;lines&quot;
) %&gt;% layout(
  title = title,
  xaxis = list(
    type = &quot;date&quot;
  ),
  yaxis = list(
    title = &quot;Price&quot;
  )
)</code></pre>
<div id="htmlwidget-1" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"visdat":{"21ac1d1359c":["function () ","plotlyVisDat"]},"cur_data":"21ac1d1359c","attrs":{"21ac1d1359c":{"y":{},"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":["function (main = NULL, sub = NULL, xlab = NULL, ylab = NULL, ","    line = NA, outer = FALSE, ...) ","{","    main <- as.graphicsAnnot(main)","    sub <- as.graphicsAnnot(sub)","    xlab <- as.graphicsAnnot(xlab)","    ylab <- as.graphicsAnnot(ylab)","    .External.graphics(C_title, main, sub, xlab, ylab, line, ","        outer, ...)","    invisible()","}"],"xaxis":{"domain":[0,1],"automargin":true,"type":"date"},"yaxis":{"domain":[0,1],"automargin":true,"title":"Price"},"hovermode":"closest","showlegend":false},"source":"A","config":{"showSendToCloud":false},"data":[{"y":[66.728615,67.557777,67.442085,67.519211,67.875954,68.184479,68.232681,67.7024,67.808464,68.059135,68.078423,68.608704,68.705116,68.820808,68.946144,69.119698,68.801537,68.579765,68.43515,68.65966,null,69.079384,69.460075,69.499115,69.28437,69.177002,69.31366,69.089149,68.835358,68.16185,67.829964,67.761635,67.419998,67.71283,67.71283,67.703072,68.152084,68.610855,69.040344,68.854881,69.108673,68.796318,68.776794,68.396111,67.908058,null,66.902657,67.341904,67.71283,67.468803,67.166206,67.419998,66.092484,65.799652,66.102249,66.834335,66.307228,66.590302,66.844093,66.092484,66.151054,66.931946,67.67379,68.786552,69.108673,68.757271,69.323418,69.918839,70.358101,70.836388,71.178024,71.949158,72.486015,73.179062,72.691002,72.96431,72.79837,72.720284,72.96431,73.06192,73.530457,73.862335,74.321098,74.428474,74.329697,73.687645,73.025841,72.897438,73.341927,73.401192,73.292534,73.904961,73.895081,74.230927,null,74.655663,74.833466,74.566765,74.645782,74.369209,74.270432,74.171654,74.161781,74.211166,74.270432,74.62603,74.833466,74.61615,74.872978,75.287834,75.445877,75.534782,75.48539,75.564407,75.564407,75.49527,75.139671,75.169304,75.080406,75.347099,75.564407,75.287834,75.090279,74.635902,74.872978,74.260551,74.003731,74.003731,74.023491,73.76667,73.035721,73.292534,73.983978,74.290184,74.043243,73.75679,73.677765,73.796303,72.917191,73.144379,73.569122,72.709755,72.413422,72.76902,72.571472,72.522079,null,72.62085,72.462814],"mode":"lines","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="looking-at-the-portfolio" class="section level1">
<h1>Looking at the portfolio</h1>
<p>We will now test the risk and returns of a portfolio containing the stocks for BNS, Shopify, GoEasy, and Air Canada.</p>
<p>Below, we take the original data frame, my_stocks, and separate out returns and price data. This differs from the earlier separation of price and returns data as we do not save it as a data frame using <em>as.data.frame</em> but instead as xml documents. This type of document can then be processes by some of the portfolio analtyics packages.</p>
<p>To test returns, we get the average returns and variance of returns. Scott explained that variance of data for stock market analysts is <em>risk</em>.</p>
<pre class="r"><code># Separate returns data, in xts format.
returns &lt;- my_stocks$returns_data

# Separate price data, in xts format.
price &lt;- my_stocks$price_data

# Calculate the average returns and risk (covariance matrix)
mean_returns &lt;- colMeans(returns)
cov_matrix &lt;- cov(returns)</code></pre>
</div>
<div id="deciding-on-your-risk-and-return-preference-in-the-stock-portfolio." class="section level1">
<h1>Deciding on your risk and return preference in the stock portfolio.</h1>
<p>The below code then combines all of the returns data into the data frame <em>my_folio</em>, or the portfolio.</p>
<pre class="r"><code># Create the portfolio
my_folio &lt;- portfolio.spec(assets = colnames(returns))</code></pre>
<p>As described by Scott, we can then set our risk levels with the min and max options. He did not specify what the values in the risk min and max mean, but they vary from 0 to 1.</p>
<p>Below is a medium risk portfolio, with min set as 0.05 and max set as 0.65.</p>
<pre class="r"><code># Add constraint 
my_folio &lt;- add.constraint(
  portfolio = my_folio, 
  type = &quot;box&quot;, 
  min = 0.05, #these are risk
  max = 0.65
)</code></pre>
<p>Or we could set a very risky portfolio! Below the very risky portfolio is set with min as 0.99 and max as 1.01.</p>
<pre class="r"><code>my_folio &lt;- add.constraint(
  portfolio = my_folio, 
  # The type means the type of investment
  type = &quot;leverage&quot;, 
  min_sum = 0.99,  #this is very risky
  max_sum = 1.01
) </code></pre>
</div>
<div id="maximize-returns-how-much-of-each-stock-to-put-in-the-portfolio" class="section level1">
<h1>Maximize returns: How much of each stock to put in the portfolio</h1>
<p>We can then run the <em>optomize.portfolio</em> function to optomize returns based on our risk parameters.</p>
<p>The function here will analyze the returns data for the stocks we selected and suggest how much of each stock we should put in our portfolio.</p>
<pre class="r"><code># Maximize the average returns with return on investment (ROI)
max_return &lt;- add.objective(
  portfolio = my_folio, 
  type = &quot;return&quot;,
  name = &quot;mean&quot;
) 

# Optimization
opt_max_return &lt;- optimize.portfolio(
  R = returns, 
  portfolio = max_return, 
  optimize_method = &quot;ROI&quot;,
  trace = TRUE
)</code></pre>
<p>One can then use the below <em>print</em> commands to print out results from the optomize portfolio function. The results are quite long, so I don’t include them.</p>
<pre class="r"><code># these print the details on how much I should invest.
#print.default(opt_max_return) #this prints a lot more than the other one.. (after)
#print(opt_max_return)</code></pre>
<p>Below is a plot that visually displays how much of each stock should be in the portfolio to maximize returns.</p>
<pre class="r"><code># Plot optimized maximum mean (i.e. return?)
plot(
  opt_max_return, 
  risk.col = &quot;StdDev&quot;, 
  return.col = &quot;mean&quot;,
  main = &quot;Minimum Variance Optimization&quot;, 
  chart.assets = TRUE,
  xlim = c(-0.5, 1), 
  ylim = c(-0.002, 0.004)
)</code></pre>
<p><img src="/post/2020-01-21-analyzing-stock-value-with-r-ladies_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>The below code does a similar function to maxamize returns, but instead minimizes risk.</p>
<pre class="r"><code># Plot optimized minimum var (i.e. risk)
plot(
  opt_min_var, 
  risk.col = &quot;StdDev&quot;, 
  return.col = &quot;mean&quot;,
  main = &quot;Minimum Variance Optimization&quot;, 
  chart.assets = TRUE,
  xlim = c(-0.5, 1), 
  ylim = c(-0.002, 0.004)
)</code></pre>
<p><img src="/post/2020-01-21-analyzing-stock-value-with-r-ladies_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
</div>
<div id="the-efficient-frontier" class="section level1">
<h1>The efficient frontier</h1>
<p>In the end, we plotted our portfolio against the efficient frontier! From a <a href="https://www.investopedia.com/terms/e/efficientfrontier.asp">quick google</a> and what I remember of the tutorial, the efficient frontier helps position the portfolio in its risk and returns level.</p>
<p>Apparently, optimal portfolios should lie on the curve displayed in the image below.</p>
<p>Wow, this was a throw back to my business school days!</p>
<pre class="r"><code># Plot efficient frontier!
chart.EfficientFrontier(
  meansd_ef,
  match.col = &quot;StdDev&quot;, # which column to use for risk
  type = &quot;l&quot;, 
  RAR.text = &quot;Sharpe Ratio&quot;,
  tangent.line = FALSE,
  chart.assets = TRUE,
  labels.assets = TRUE,
  xlim = c(-0.5, 1), 
  ylim = c(-0.002, 0.004),
  element.color = &quot;blue&quot;
)</code></pre>
<p><img src="/post/2020-01-21-analyzing-stock-value-with-r-ladies_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>This was quite a dive into R analysis of stocks and portfolios! Thank you again Scott for putting together the tutorial and pushing my knowledge of R into a new domain.</p>
<p>&lt;3 Megan</p>
</div>

	    </div>
	    
	<div class="about">
	<p>

    </p>
</div>

		<nav id="pagination">
			
			<a class="next" href="/2020/01/11/simple-a-hugo-theme-small-edits-to-personalize/">Next</a>
		</nav>
	
		        <footer>
		        	Built with <a href="https://github.com/spf13/hugo">Hugo</a>
		        	<p>© Megan Wylie 2020 </p>
							Based on <a href="https://github.com/AlexFinn/simple-a">simple-a theme</a>
		        </footer>
		    </div>
		  </div>
		</div>
      </div>
    </div>
</body>

<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u=(("https:" == document.location.protocol) ? "https" : "http") + ":change-me";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 4]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
    g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>


</html>

